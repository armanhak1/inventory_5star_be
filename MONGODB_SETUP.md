# MongoDB Setup Guide

## ğŸ“‹ Prerequisites

You have created a MongoDB Atlas account and cluster. Now let's connect it!

---

## ğŸ”‘ Step 1: Get Your MongoDB Connection String

1. **Go to MongoDB Atlas**: https://cloud.mongodb.com
2. **Select your cluster** (the one you created)
3. Click **"Connect"** button
4. Choose **"Connect your application"**
5. Select **"Node.js"** as the driver
6. **Copy the connection string** - it looks like:
   ```
   mongodb+srv://username:<password>@cluster.mongodb.net/?retryWrites=true&w=majority
   ```

---

## âš™ï¸ Step 2: Configure Your Environment

1. **Open the `.env` file** in `5stat_be/` directory
   
2. **Replace the placeholder** with your actual MongoDB connection string:
   
   ```env
   # Replace this line:
   MONGODB_URI=mongodb+srv://username:password@cluster.mongodb.net/five-star-care?retryWrites=true&w=majority
   
   # With your actual connection string from MongoDB Atlas
   MONGODB_URI=mongodb+srv://YOUR_USERNAME:YOUR_PASSWORD@YOUR_CLUSTER.mongodb.net/five-star-care?retryWrites=true&w=majority
   ```

3. **Important**: 
   - Replace `<password>` with your actual database user password
   - Add `/five-star-care` after `.mongodb.net` to specify the database name
   - Keep `?retryWrites=true&w=majority` at the end

### Example:
```env
# Before (from MongoDB Atlas):
mongodb+srv://admin:<password>@cluster0.abc123.mongodb.net/?retryWrites=true&w=majority

# After (with your password and database name):
MONGODB_URI=mongodb+srv://admin:MySecurePassword123@cluster0.abc123.mongodb.net/five-star-care?retryWrites=true&w=majority
```

---

## ğŸŒ± Step 3: Seed Your Database

Once your `.env` is configured, seed the database with initial data:

```bash
cd /Users/inspirovatecreatives/Desktop/5stat_be
npm run seed
```

**You should see:**
```
ğŸŒ± Starting database seed...
âœ… MongoDB connected successfully
ğŸ“¦ Database: five-star-care
ğŸ—‘ï¸  Cleared 0 existing items
âœ… Successfully seeded 10 items

Seeded items:
  â€¢ Wheelchairs (qty): 12
  â€¢ Walker Inventory (qty): 8
  â€¢ Oxygen Tanks (qty): 15
  â€¢ Hospital Beds (qty): 6
  â€¢ Staff Attendance (pct): 95
  â€¢ Medication Compliance (pct): 98
  â€¢ Patient Satisfaction (pct): 92
  â€¢ Wound Care Supplies (qty): 45
  â€¢ Bed Occupancy Rate (pct): 88
  â€¢ Blood Pressure Monitors (qty): 10
```

---

## ğŸš€ Step 4: Start the Server

```bash
npm run dev
```

**You should see:**
```
âœ… MongoDB connected successfully
ğŸ“¦ Database: five-star-care
ğŸš€ Server is running on port 3000
ğŸ“¦ Inventory API: http://localhost:3000/api/inventory
ğŸ”„ Reset endpoint: POST http://localhost:3000/api/inventory/reset
```

---

## âœ… Step 5: Test the Connection

Open a new terminal and test the API:

```bash
# Get all items from MongoDB
curl http://localhost:3000/api/inventory

# You should see your 10 seeded items!
```

---

## ğŸ“Š MongoDB Collection Structure

Your MongoDB database will have **one collection**:

### Collection: `items`
Stores all inventory items with the following schema:

```javascript
{
  _id: ObjectId,           // MongoDB auto-generated ID
  name: String,            // Item name (required, max 100 chars)
  type: 'qty' | 'pct',    // Item type (required)
  value: Number,           // Current value (required, min: 0)
  notes: String,           // Optional notes (max 500 chars)
  updatedAt: String,       // ISO timestamp
  createdAt: Date,         // Auto-generated by Mongoose
  __v: Number              // Version key (Mongoose)
}
```

**Note**: The API automatically converts `_id` to `id` for frontend compatibility.

---

## ğŸ”„ Useful Commands

### Seed Database
Populates database with 10 sample items:
```bash
npm run seed
```

### Reset via API
Reset to mock data without restarting server:
```bash
curl -X POST http://localhost:3000/api/inventory/reset
```

### Check Connection
```bash
curl http://localhost:3000
```

---

## ğŸ› ï¸ Troubleshooting

### Error: "MongoServerError: bad auth"
**Problem**: Incorrect username or password

**Solution**: 
1. Check your MongoDB Atlas credentials
2. Make sure you replaced `<password>` with your actual password
3. Verify the password doesn't have special characters that need URL encoding

### Error: "connect ECONNREFUSED"
**Problem**: Can't connect to MongoDB

**Solution**:
1. Check your internet connection
2. Verify the connection string is correct
3. Make sure your IP is whitelisted in MongoDB Atlas:
   - Go to Network Access in Atlas
   - Click "Add IP Address"
   - Click "Allow Access from Anywhere" (0.0.0.0/0)

### Error: "Database name cannot be empty"
**Problem**: Missing database name in connection string

**Solution**: Make sure your connection string includes `/five-star-care` before the query parameters:
```
mongodb+srv://user:pass@cluster.mongodb.net/five-star-care?retryWrites=true&w=majority
                                                    ^^^^^^^^^^^^^^^^
```

### No Items Returned
**Problem**: Database is empty

**Solution**: Run the seed command:
```bash
npm run seed
```

---

## ğŸŒ Frontend Configuration

Your frontend is already configured to use the API! No changes needed.

The frontend (`my-app`) will automatically:
- âœ… Fetch items from MongoDB via API
- âœ… Create new items in MongoDB
- âœ… Update items in MongoDB
- âœ… Delete items from MongoDB

All data now persists in MongoDB! ğŸ‰

---

## ğŸ“ MongoDB Structure

```
Database: five-star-care
â””â”€â”€ Collection: items (inventory items)
    â”œâ”€â”€ Item 1 (Wheelchairs)
    â”œâ”€â”€ Item 2 (Walkers)
    â”œâ”€â”€ Item 3 (Oxygen Tanks)
    â””â”€â”€ ... (10 items total)
```

---

## ğŸ”’ Security Notes

1. **Never commit `.env` file** - it's already in `.gitignore`
2. **Use strong passwords** for MongoDB users
3. **Limit IP access** in MongoDB Atlas (use specific IPs in production)
4. **Use environment variables** for sensitive data
5. **Enable MongoDB Atlas encryption** (enabled by default)

---

## ğŸ¯ Next Steps

Your MongoDB integration is complete! You now have:
- âœ… MongoDB Atlas connected
- âœ… Mongoose models configured
- âœ… All API endpoints using MongoDB
- âœ… Seed data populated
- âœ… Data persistence across server restarts

**Your data is now stored in the cloud!** ğŸŒ¥ï¸

---

## ğŸ“š Additional Resources

- [MongoDB Atlas Documentation](https://www.mongodb.com/docs/atlas/)
- [Mongoose Documentation](https://mongoosejs.com/docs/)
- [Connection String Format](https://www.mongodb.com/docs/manual/reference/connection-string/)

